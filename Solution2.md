# 问题二：非完美工况下的鲁棒性分析

## 1. 核心目标

量化运输系统在非完美工况下（系绳摇摆、火箭故障、电梯损坏等）的影响，通过概率建模和鲁棒优化修正基础模型，分析成本、时间的变化幅度，并提出应对策略。

---

## 2. 参数继承（来自问题一）

| 参数类型 | 符号 | 数值 | 来源 |
|:---|:---|:---|:---|
| **太空电梯** |
| 固定年成本（每个港口） | $C_{E,f}$ | 3.0 × 10⁹ USD/年 | 问题一 |
| 转运成本（锚点→月球） | $C_{E,u}$ | 92,700 USD/吨 | 问题一 |
| 总名义运力（3个港口） | $Q_{E,total}$ | 537,000 吨/年 | 问题一 |
| **火箭系统** |
| 固定年成本（每个发射场） | $C_{R,l}$ | 各发射场不同 | 问题一数据 |
| 有效载荷（每次发射） | $Q_R$ | 100–150 吨 | 问题一 |
| 直接运输成本 | $c_R$ | 1,500,000 USD/吨 | 问题一 |
| 单次发射成本 | $C_{R,i}$ | $Q_R \times c_R$ | 推导得出 |
| 发射频率增长模型 | — | 分段二次-线性增长 | 问题一第6节 |
| 每个发射场最大发射次数 | $x_{max,i}$ | 200 次/年 | 问题一 |
| **多准则优化** |
| AHP 权重 | $\omega_C, \omega_T$ | 1/6, 5/6 | 问题一第5节 |
| 归一化上界 | $C_{max}, T_{max}$ | 150 万亿 USD, 350 年 | 问题一第9节 |
| **任务参数** |
| 月球总运输质量 | $M$ | 100,000,000 吨 | 问题一 |

---

## 3. 故障模式与概率参数

### 3.1 关键假设
- **独立性**：所有故障事件统计独立（无相关性故障）
- **平稳性**：故障概率在整个任务周期内保持恒定
- **修复优先级**：电梯故障触发即时修复；火箭故障使用冗余（备用发射）

### 3.2 故障参数表

| 运输系统 | 故障类型 | 量化参数 |
|:---|:---|:---|
| **太空电梯** | **FE1**: 系绳摇摆 | • 发生概率：$p_{E1} = 5\%$ 每年<br>• 运力折减系数：$\beta_{E1} = 0.3$（降至 **70% 运力**）<br>• 无额外成本（计入固定运营成本） |
| | **FE2**: 攀爬器故障 | • 发生概率：$p_{E2} = 3\%$ 每港口每年<br>• 停运时间：$t_{E2} = 30$ 天/次<br>• 修复成本：$C_{E,repair} = 5000$ 万 USD/次 |
| **火箭系统** | **FR1**: 发射失败 | • 失败率：$p_{R1} = 3\%$ 每次发射<br>• 后果：载荷丢失，需要备用发射（几何分布）<br>• 无单独修复成本（计入每次发射成本 $C_{R,i}$） |
| | **FR2**: 发射场维护 | • 发生概率：$p_{R2} = 4\%$ 每发射场每年<br>• 停运时间：$t_{R2} = 60$ 天/次<br>• 无单独修复成本（计入固定成本 $C_{R,l}$） |

**参数解释**：
- **系绳摇摆**：当摇摆发生时（年概率 5%），电梯通过量暂时降至名义运力的 70%。系数 $(1 - p_{E1} \times \beta_{E1})$ 表示考虑摇摆风险后的**期望年运力利用率**。
- **攀爬器故障**：每个港口每年有 3% 概率发生 30 天停运。系数 $(1 - p_{E2} \times t_{E2}/365)$ 表示**期望年正常运行时间占比**。
- **发射失败**：遵循**几何分布** — 成功交付 1 次载荷，期望需要的发射次数为 $1/(1-p_{R1})$（推导见第 5.2.1 节）。

---

## 4. 场景 A：仅使用太空电梯（故障修正）

### 4.1 决策变量
- **连续变量**：$T_A'$ — 有效任务工期（年）
- **辅助变量**：
  - $Q_{E,eff}$ — 考虑故障后的有效电梯运力（吨/年）
  - $E[N_{E2}]$ — 任务期间攀爬器故障次数期望

### 4.2 目标函数
$$
\min Z_A' = \omega_C \times \frac{C_A'}{C_{max}} + \omega_T \times \frac{T_A'}{T_{max}}
$$

其中：

**期望总成本**：
$$
C_A' = 3 \times C_{E,f} \times T_A' + M \times C_{E,u} + 3 \times C_{E,repair} \times E[N_{E2}]
$$

成本组成：
- **固定运营成本**：3 个港口 × $C_{E,f}$ × $T_A'$
- **可变转运成本**：总质量 × 单位转运成本
- **修复成本**：3 个港口 × 每次修复成本 × 期望故障次数

**期望故障次数**（泊松近似，针对稀有事件）：
$$
E[N_{E2}] = 3 \times p_{E2} \times T_A'
$$

**有效运力**（复合故障调整）：
$$
Q_{E,eff} = Q_{E,total} \times \underbrace{(1 - p_{E1} \times \beta_{E1})}_{\text{摇摆影响}} \times \underbrace{\left(1 - p_{E2} \times \frac{t_{E2}}{365}\right)}_{\text{停运影响}}
$$

**推导过程**：
1. **摇摆影响**：5% 年概率发生摇摆，运力降至 70%。期望运力 = $1 \times 0.95 + 0.7 \times 0.05 = 0.985 = 1 - 0.05 \times 0.3$
2. **停运影响**：3% 概率发生 30 天停运 → 年可用率 = $1 - 0.03 \times (30/365) \approx 0.9975$
3. **复合效应**：两个因子相乘（假设独立性）

**有效任务工期**：
$$
T_A' = \frac{M}{Q_{E,eff}}
$$

### 4.3 约束条件
1. 运力正性约束：$Q_{E,eff} > 0$
2. 非负约束：$E[N_{E2}] \geq 0, \, T_A' \geq 0$

---

## 5. 场景 B：仅使用火箭（故障修正）

### 5.1 决策变量
- **0-1 变量**：$y_i \in \{0,1\}$，$i=1,\ldots,10$ — 发射场选择指示变量
- **连续变量**：$x_i(t)$ — 第 $i$ 个发射场在时刻 $t$ 的发射频率（次/年），遵循**问题一的分段二次-线性增长模型**
- **辅助变量**：
  - $Q'_{R,total}$ — 火箭总有效运力（吨/年）
  - $N'_{R,i}$ — 第 $i$ 个发射场在任务期间的期望总发射次数（考虑 3% 失败率）

### 5.2 目标函数
$$
\min Z_B' = \omega_C \times \frac{C_B'}{C_{max}} + \omega_T \times \frac{T_B'}{T_{max}}
$$

其中：

**期望总成本**（故障修正）：
$$
C_B' = \sum_{i=1}^{10} \left( y_i \times C_{R,l} \times T_B' \right) + \sum_{i=1}^{10} \left( y_i \times N'_{R,i} \times C_{R,i} \right)
$$

成本组成：
- **固定运营成本**：各发射场固定年成本之和 × 任务工期
- **发射成本**：总发射次数（含失败补发）× 单次发射成本 $C_{R,i} = Q_R \times c_R$

### 5.2.1 期望发射次数（几何分布推导）

**问题**：当 $p_{R1} = 3\%$ 的发射失败率时，交付 $M_{R,i}$ 吨物资需要多少次发射？

**名义发射次数**（完美工况）：
$$
N_{R,i} = \frac{M_{R,i}}{Q_R \times (1 - p_{R1})}
$$
其中 $(1-p_{R1})$ 考虑了只有 97% 的发射能成功交付载荷。

**补发次数**（几何分布）：成功交付 1 次载荷的期望发射次数为：
$$
E[\text{单次成功的发射次数}] = \sum_{k=1}^{\infty} k \cdot p_{R1}^{k-1} \cdot (1-p_{R1}) = \frac{1}{1-p_{R1}}
$$
其中：
- $k=1$：第 1 次发射成功 → 概率 $(1-p_{R1})$，需要 1 次发射
- $k=2$：第 1 次失败、第 2 次成功 → 概率 $p_{R1} \cdot (1-p_{R1})$，需要 2 次发射
- $k=n$：前 $n-1$ 次失败、第 $n$ 次成功 → 概率 $p_{R1}^{n-1} \cdot (1-p_{R1})$，需要 $n$ 次发射

**期望总发射次数**（合并两种效应）：
$$
N'_{R,i} = \frac{M_{R,i}}{Q_R \times (1-p_{R1})} \times \frac{1}{1-p_{R1}} = \frac{M_{R,i}}{Q_R \times (1-p_{R1})^2}
$$

对于选中子集 $S$ 中的发射场 $i$，其分配的质量与其贡献成正比：
$$
M_{R,i} = M \times \frac{y_i \times Q_R \times (1-p_{R1})}{\sum_{j \in S} y_j \times Q_R \times (1-p_{R1})} = M \times \frac{y_i}{\sum_{j=1}^{10} y_j}
$$
（假设所有发射场载荷 $Q_R$ 相同）

因此：
$$
N'_{R,i} = \frac{M \times y_i}{\sum_{j=1}^{10} \left( y_j \times Q_R \times (1-p_{R1}) \right)} \times \frac{1}{1-p_{R1}}
$$

### 5.2.2 有效火箭运力

**综合运力**（考虑 FR1 + FR2 两种故障模式）：
$$
Q'_{R,total} = \sum_{i=1}^{10} \left[ y_i \times x_i \times Q_R \times \underbrace{(1-p_{R1})}_{\text{载荷交付率}} \times \underbrace{\left(1 - p_{R2} \times \frac{t_{R2}}{365}\right)}_{\text{发射场可用率}} \right]
$$

其中：
- $(1-p_{R1})$：只有 97% 的发射能交付载荷
- $(1 - p_{R2} \times t_{R2}/365)$：发射场停运降低年运力（4% 概率发生 60 天停运 → 0.993 可用率）

**任务工期**（使用**问题一的分段增长模型**）：
$$
T_B' = \text{PiecewiseGrowthSolver}\left( \{x_i(t)\}_{i \in S}, M, Q_R, p_{R1}, p_{R2} \right)
$$

求解器需要处理：
1. **阶段 1**：纯二次增长（$x_i(t) = x_{0,i} + g_i \cdot t$），直到第一个发射场达到 200 次/年
2. **阶段 2+**：分段线性片段，随着发射场陆续达到运力上限
3. **故障调整**：在累积质量计算中整合 $(1-p_{R1}) \times (1 - p_{R2} \times t_{R2}/365)$

### 5.3 约束条件
1. **发射场选择限制**：$\sum_{i=1}^{10} y_i \leq 10$
2. **发射频率上下界**：$0 \leq x_i \leq x_{max,i} \times y_i$（每个发射场上限 200 次/年，同问题一）
3. **运力可行性**：$Q'_{R,total} \geq M / T_B'$
4. **0-1 约束**：$y_i \in \{0,1\}$
5. **非负约束**：$x_i \geq 0, \, T_B' \geq 0$

### 5.4 优化方法
**基于枚举的 0-1 规划**（同问题一）：
- 评估所有 $2^{10} - 1 = 1023$ 个非空发射场组合
- 对每个组合，求解分段增长模型得到 $(C_B', T_B')$
- 选择归一化加权目标函数最小的组合

---

## 6. 场景 C：混合系统（故障修正）

### 6.1 决策变量
- **0-1 变量**：$y_i \in \{0,1\}$，$i=1,\ldots,10$ — 火箭发射场选择
- **连续变量**：$\alpha \in [0,1]$ — 电梯运输质量占比
- **连续变量**：$x_i(t)$ — 第 $i$ 个发射场在时刻 $t$ 的发射频率
- **辅助变量**：$Q_{E,eff}$、$Q'_{R,total}$、$N'_{R,i}$、$E[N_{E2}]$

### 6.2 目标函数
$$
\min Z_C' = \omega_C \times \frac{C_C'}{C_{max}} + \omega_T \times \frac{T_C'}{T_{max}}
$$

其中：

**期望总成本**：
$$
\begin{aligned}
C_C' = &\left( 3 \times C_{E,f} + \sum_{i=1}^{10} y_i \times C_{R,l} \right) \times T_C' \quad &\text{（固定成本）} \\
&+ \alpha M \times C_{E,u} \quad &\text{（电梯转运）} \\
&+ \sum_{i=1}^{10} \left( y_i \times N'_{R,i} \times C_{R,i} \right) \quad &\text{（火箭发射）} \\
&+ 3 \times C_{E,repair} \times p_{E2} \times T_C' \quad &\text{（修复成本）}
\end{aligned}
$$

**期望火箭发射次数**（混合场景）：
$$
N'_{R,i} = \frac{(1-\alpha) M \times y_i}{\sum_{j=1}^{10} y_j \times Q_R \times (1-p_{R1})} \times \frac{1}{1-p_{R1}}
$$
（类似场景 B 的推导，将总质量 $M$ 替换为火箭分配质量 $(1-\alpha)M$）

**时间同步**（电梯和火箭同时完成运输）：
$$
T_C' = \frac{\alpha M}{Q_{E,eff}} = \frac{(1-\alpha) M}{\int_0^{T_C'} Q'_{R,total}(t) \, dt}
$$

对于分段增长模型，火箭积分需数值计算。同步条件可表示为：
$$
\alpha = \frac{Q_{E,eff}}{Q_{E,eff} + \overline{Q}'_{R,total}}
$$
其中 $\overline{Q}'_{R,total}$ 是区间 $[0, T_C']$ 上的**时间平均有效火箭运力**。

**求解方法**（同问题一场景 C）：
- 对 $T_C'$ 使用**二分查找**，找到电梯和火箭运力平衡的工期
- 对每个试探值 $T_C'$，计算：
  1. 火箭交付质量：$M_R = \int_0^{T_C'} Q'_{R,total}(t) \, dt$
  2. 电梯交付质量：$M_E = Q_{E,eff} \times T_C'$
  3. 检查 $M_R + M_E = M$ 是否成立
- 迭代直到收敛（通常 50 次迭代可达 1e-6 精度）

### 6.3 约束条件
1. **同步约束**：$T_C' = \frac{\alpha M}{Q_{E,eff}} = \frac{(1-\alpha) M}{\int_0^{T_C'} Q'_{R,total}(t) \, dt}$
2. **发射频率约束**：$0 \leq x_i \leq x_{max,i} \times y_i$（200 次/年上限）
3. **发射场选择**：$\sum_{i=1}^{10} y_i \leq 10$
4. **0-1 约束**：$y_i \in \{0,1\}$
5. **占比约束**：$0 \leq \alpha \leq 1$
6. **非负约束**：$x_i \geq 0, \, T_C' \geq 0$

---

## 7. 多场景比较与选择

### 7.1 决策指标
对每个场景 $k \in \{A, B, C\}$，计算归一化加权目标：
$$
Z_k' = \omega_C \times \frac{C_k'}{C_{max}} + \omega_T \times \frac{T_k'}{T_{max}}
$$

**选择** $\min\{Z_A', Z_B', Z_C'\}$ 对应的场景。

### 7.2 影响量化
比较故障修正结果 $(C_k', T_k')$ 与问题一完美工况基准 $(C_k, T_k)$：

**成本增幅**：
$$
\Delta C_k = \frac{C_k' - C_k}{C_k} \times 100\%
$$

**时间增幅**：
$$
\Delta T_k = \frac{T_k' - T_k}{T_k} \times 100\%
$$

**鲁棒性排序**：使用 **TOPSIS**（同问题一）对场景进行多准则排序：
- 期望成本
- 期望时间
- 成本方差（来自 Monte Carlo，见第 8 节）
- 时间方差

---

## 8. 敏感性分析：Monte Carlo 仿真

### 8.1 目标
量化故障参数变化对输出指标（成本、时间）的不确定性传播，识别驱动鲁棒性的关键参数。

### 8.2 方法论

**步骤 1：参数采样**

为故障参数定义概率分布（基准值 ± 扰动）：

| 参数 | 基准值 | 采样分布 | 理由 |
|:---|:---|:---|:---|
| $p_{E1}$ | 5% | 均匀分布[3%, 7%] | 摇摆概率受太阳活动、微陨石通量影响 |
| $\beta_{E1}$ | 0.3 | 均匀分布[0.2, 0.4] | 运力折减取决于摇摆幅度（未建模的动力学） |
| $p_{E2}$ | 3% | 均匀分布[1%, 5%] | 攀爬器故障率对未测试技术不确定 |
| $t_{E2}$ | 30 天 | 均匀分布[20, 40] 天 | 修复时间取决于备件可用性、人员准备度 |
| $p_{R1}$ | 3% | 均匀分布[2%, 4%] | 发射失败率可能随经验改善（学习曲线） |
| $p_{R2}$ | 4% | 均匀分布[2%, 6%] | 维护频率取决于发射强度 |
| $t_{R2}$ | 60 天 | 均匀分布[45, 75] 天 | 维护时长受基础设施准备度影响 |

**采样策略**：拉丁超立方采样（LHS），**10,000 个样本**，确保 7 维参数空间的覆盖。

**步骤 2：仿真循环**

对每个样本 $s = 1, \ldots, 10000$：
1. 抽取参数集 $\theta_s = \{p_{E1}^{(s)}, \beta_{E1}^{(s)}, p_{E2}^{(s)}, t_{E2}^{(s)}, p_{R1}^{(s)}, p_{R2}^{(s)}, t_{R2}^{(s)}\}$
2. 使用采样参数求解所有三个场景（A、B、C）
3. 记录输出：$(C_A^{(s)}, T_A^{(s)}, C_B^{(s)}, T_B^{(s)}, C_C^{(s)}, T_C^{(s)}, Z_A^{(s)}, Z_B^{(s)}, Z_C^{(s)})$

**步骤 3：统计分析**

对每个场景 $k \in \{A,B,C\}$：

**集中趋势**：
- 均值：$\mu_{C_k} = \frac{1}{10000} \sum_{s=1}^{10000} C_k^{(s)}$
- 中位数：$\text{Med}(C_k)$（对离群值鲁棒）

**离散程度**：
- 标准差：$\sigma_{C_k}$
- 变异系数：$CV_{C_k} = \sigma_{C_k} / \mu_{C_k}$（归一化风险度量）

**置信区间**（非参数方法）：
- 90% CI：[第 5 百分位数，第 95 百分位数]
- 95% CI：[第 2.5 百分位数，第 97.5 百分位数]

**步骤 4：灵敏度指数（Sobol 分析）**

将输出方差分解为各参数的贡献：
$$
\text{Var}(C_k) = \sum_{i=1}^{7} V_i + \sum_{i<j} V_{ij} + \cdots + V_{1,\ldots,7}
$$

其中：
- **一阶指数**：$S_i = V_i / \text{Var}(C_k)$ — 参数 $i$ 单独贡献的方差
- **总阶指数**：$S_{T,i}$ — 参数 $i$ 包含所有交互项的方差贡献

**实现方式**：使用 SALib 库，10,000 个 LHS 样本。

### 8.3 可视化（Nature 风格出版标准）

遵循 Guideline 要求：

**图 1：成本分布热力图（2D 边际分布）**
- **X 轴**：$p_{R1}$（火箭失败率）
- **Y 轴**：$p_{E2}$（电梯故障率）
- **颜色**：均值成本 $E[C_C]$（发散色图：蓝色 = 低，红色 = 高）
- **排版**：Times New Roman，粗体标签（18pt），粗体刻度（16pt）
- **格式**：高分辨率 PDF，突出黑色边框

**图 2：龙卷风图（灵敏度排序）**
- **X 轴**：成本/时间变化（相对基准的 %）
- **Y 轴**：按总 Sobol 指数排序的参数
- **柱状图**：±1σ 扰动影响（降序排列）
- **颜色**：专业调色板（例如 `#1f77b4`、`#ff7f0e`、`#2ca02c`）

**图 3：累积分布函数（CDFs）**
- **X 轴**：成本（万亿 USD）
- **Y 轴**：累积概率
- **曲线**：三个场景（A、B、C）叠加
- **标注**：90% CI 阴影区域，中位数标记
- **无内部标题** — 仅通过轴标签传达上下文

**图 4：3D 曲面（时间 vs. 双参数变化）**
- **X 轴**：$p_{R1}$
- **Y 轴**：$p_{E1}$
- **Z 轴**：任务工期 $T_C'$
- **曲面**：从 Monte Carlo 样本插值
- **色图**：Viridis（感知均匀）

所有图表必须：
- 使用动态 Y 轴范围（若从 0 开始会掩盖方差则不强制）
- 导出为 PDF，300 DPI
- 脚本头部包含参数调整指南（颜色、字体、范围的行号）

---

## 9. 缓解策略与建议

基于灵敏度分析结果，提出运营调整方案：

### 9.1 若电梯故障主导（$S_{T,p_{E2}}$ 或 $S_{T,\beta_{E1}}$ > 0.4）
- **策略**：投资冗余攀爬器（每个港口配备热备份）
- **成本效益**：比较备用设备成本 vs. 期望停运损失
- **替代方案**：将更多质量转移至火箭（场景 C 中增加 $1-\alpha$）

### 9.2 若火箭故障主导（$S_{T,p_{R1}}$ > 0.4）
- **策略**：增加发射场冗余（0-1 优化中选择更多发射场）
- **实施方式**：修改约束为 $\sum y_i \geq N_{min}$（例如 $N_{min} = 6$）
- **权衡**：更高固定成本 vs. 更低故障风险

### 9.3 若两个系统均敏感
- **策略**：维持混合方案（场景 C），平衡 $\alpha \approx 0.5$
- **应急计划**：预先协商紧急发射合同以应对激增运力需求

---

## 10. 模型验证检查清单

- [ ] 所有故障概率 $p_{E1}, p_{E2}, p_{R1}, p_{R2} \in [0,1]$
- [ ] 有效运力 $Q_{E,eff}, Q'_{R,total} > 0$（非退化）
- [ ] 几何分布期望 $1/(1-p_{R1}) \approx 1.0309$（当 $p_{R1}=3\%$）
- [ ] 分段增长轨迹单调递增直到运力上限
- [ ] 混合场景同步：$|M_E + M_R - M| < 10^{-6}$ 吨（数值容差）
- [ ] Monte Carlo 收敛：成本/时间均值在 10,000 样本后稳定（检查移动平均）
- [ ] Sobol 指数归一化：$\sum S_{T,i} \approx 1$（允许小的数值误差）
- [ ] 所有可视化符合 Nature 风格标准（粗体字体、无标题、PDF 导出）

---

## 11. 与问题一的关键变化总结

| 方面 | 问题一（完美工况） | 问题二（故障修正） |
|:---|:---|:---|
| **电梯运力** | $Q_{E,total} = 537{,}000$ 吨/年 | $Q_{E,eff} = Q_{E,total} \times 0.985 \times 0.9975 \approx 529{,}000$ 吨/年 |
| **火箭发射次数** | 名义 $N_{R,i}$ | $N'_{R,i} = N_{R,i} / (1-p_{R1})^2 \approx 1.062 \times N_{R,i}$ |
| **成本模型** | 固定 + 可变 | 增加修复成本：$C_{E,repair} \times E[N_{E2}]$ |
| **优化方法** | 确定性 0-1 规划 | 随机性（Monte Carlo + Sobol 灵敏度） |
| **输出** | 单一 $(C,T)$ 值对 | 概率分布 + 置信区间 |
| **决策指标** | 最小化 $Z = \omega_C \cdot C/C_{max} + \omega_T \cdot T/T_{max}$ | 相同，但也按鲁棒性排序（CV、最坏情况） |
